# reads raw data, processes it and generates demand scenarios for each product 

import logging 
import json 
import pandas as pd 
import typing 
import os
import math
import json

import random
import numpy as np
import scipy.stats as stats

log = logging.getLogger(__name__)

class Config(typing.NamedTuple):
    """Configuration of instance to be generated.

    Args:
        raw_data_path (str): Folder where raw data is located.
        instance_path (str): Folder where file will be created.
        num_time_points (int): Number of time points for which demands have to be created.
        instance_name (str): Name of file to be created. 
        location_id (int): Location id to consider from raw data. 
        lead_time_in_weeks (int): Lead time in weeks
        container_volume (float): Volume of each container 
        items_file (str): name of file that contains master list of products. 
        forecast_file (str): name of file that contains the forecast. 
        open_positions_file (str): name of file that contains open positions. 
    """
    raw_data_path: str = os.path.abspath(
        os.path.join(os.path.dirname(__file__), '..', 'data', 'raw'))
    instance_path: str = os.path.abspath(
        os.path.join(os.path.dirname(__file__), '..', 'data'))
    instance_name: str = 'static_instance'
    num_time_points: int = 53
    location_id: int = 3000
    lead_time_in_weeks: int = 12 
    container_volume: float = 2350.0
    items_file: str = 'item_master_200.csv'
    forecast_file: str = 'forecast.csv'
    open_positions_file: str = 'open_po.csv'

class Product(typing.NamedTuple):
    id: int 
    volume: float
    safety_stock_in_weeks: int
    
    def to_json(self): 
        return {
            "id": self.id, 
            "volume": self.volume, 
            "safety_stock_in_weeks": self.safety_stock_in_weeks
        }

class StaticData(typing.NamedTuple):
    config: Config
    products: typing.List[Product]
    product_mle_params: typing.Dict[int, typing.Dict[str, float]]
    demand_data: typing.Dict[str, int]
    ramping_factor: typing.Dict[int, int]
    F: typing.Dict[str, int]
    H: typing.Dict[str, int]
    G: typing.Dict[str, int]
    alpha: int

    @classmethod 
    def build(cls, cfg: Config): 
        """ 
        1. Read and filter items in the master item list. 
        2. Collect list of items and create products. 
        """
        # read all the items in the master file 
        items_file = f'{cfg.raw_data_path}/{cfg.items_file}'
        df = pd.read_csv(items_file)
        
        # remove items with zero safety stock and zero on-hand stock
        df.drop(df[(df.on_hand == 0) & (df.safety_stock == 0)].index, inplace = True)

        #keep only 5 products (toy problem!!!!!!!)
        #df = df.tail(5)
        
        # create products 
        products = [Product(id = i, volume = v, safety_stock_in_weeks = s) 
                    for i, v, s in zip(df['item'], df['volume'], df['safety_stock'])]
        product_ids = set([p.id for p in products])
        
        """ 
        1. Read demand forecast for each product, and remove leading/trailing zeros
        2. Fit a gamma distribution for the forecast
        """ 
        # read all entries in forecast file 
        forecast_file = f'{cfg.raw_data_path}/{cfg.forecast_file}'
        df = pd.read_csv(forecast_file)
        
        # first filter based on product ids and ceil the demand forecast 
        df = df[df['item'].isin(product_ids)]
        df['units'] = df['units'].apply(math.ceil).abs()

        mle_params = {}
        demand_data = {}        
        for id in product_ids:
            id_temp = id
            if id not in df['item'].values:
                id_temp = 20052773005
            df_item = df[(df['item'] == id_temp)]
            observations = np.array(df_item['units'])
            alpha, loc, scale = stats.gamma.fit(observations)
            mle_params[id] = {"alpha": alpha, "loc": loc, "scale": scale}
            # generating data is as simple as 
            # data = stats.gamma.rvs(alpha, loc=loc, scale=scale, size=100)
            demand = stats.gamma.rvs(alpha, loc=loc, scale=scale, size=cfg.num_time_points)
            demand = np.ceil(demand).astype(int)
            for week in range(cfg.num_time_points):
                key = f"{id}_{week}"  # Create a string representation of the key since key cant be tuple
                demand_data[key] = abs(int(demand[week]))
        
        """
        1. Ramping factor for each product.
        ramping_factor = {f"{id}" : random.randint(5, 15) for id in product_ids}
        """

        #200 products ramping factor
        ramping_factor = {
        "20052773030": 2,
        "20052773001": 2,
        "20052773002": 1,
        "20052773003": 1,
        "20052773004": 1,
        "20052773005": 1,
        "20052773006": 2,
        "20052773007": 1,
        "20052773008": 1,
        "20052773009": 2,
        "20052773010": 2,
        "20052773011": 1,
        "20052773012": 1,
        "20052773013": 2,
        "20052773014": 2,
        "20052773015": 2,
        "20052773016": 1,
        "20052773017": 1,
        "20052773018": 1,
        "20052773019": 1,
        "20052773020": 2,
        "20052773021": 1,
        "20052773022": 1,
        "20052773023": 2,
        "20052773024": 2,
        "20052773025": 1,
        "20052773038": 4,
        "20052773039": 5,
        "20052773040": 2,
        "20052773041": 5,
        "20052773026": 2,
        "20052773027": 1,
        "20052773042": 3,
        "20052773043": 4,
        "20052773044": 6,
        "20052773045": 5,
        "20052773028": 2,
        "20052773046": 4,
        "20052773047": 7,
        "20052773048": 3,
        "20052773049": 4,
        "20052773050": 4,
        "20052773033": 2,
        "20052773034": 1,
        "20052773035": 2,
        "20052773036": 1,
        "20052773037": 2,
        "20052773031": 1,
        "20052773032": 2,
        "20052773029": 1,
        "20052773051": 1,
        "20052773052": 2,
        "20052773053": 1,
        "20052773054": 1,
        "20052773055": 2,
        "20052773056": 1,
        "20052773057": 2,
        "20052773058": 1,
        "20052773059": 1,
        "20052773060": 2,
        "20052773061": 1,
        "20052773062": 2,
        "20052773063": 1,
        "20052773064": 1,
        "20052773065": 2,
        "20052773066": 1,
        "20052773067": 2,
        "20052773068": 1,
        "20052773069": 1,
        "20052773070": 2,
        "20052773071": 1,
        "20052773072": 2,
        "20052773073": 1,
        "20052773074": 1,
        "20052773075": 2,
        "20052773076": 1,
        "20052773077": 2,
        "20052773078": 1,
        "20052773079": 1,
        "20052773080": 2,
        "20052773081": 1,
        "20052773082": 2,
        "20052773083": 1,
        "20052773084": 1,
        "20052773085": 2,
        "20052773086": 1,
        "20052773087": 2,
        "20052773088": 1,
        "20052773089": 1,
        "20052773090": 2,
        "20052773091": 1,
        "20052773092": 2,
        "20052773093": 1,
        "20052773094": 1,
        "20052773095": 2,
        "20052773096": 1,
        "20052773097": 2,
        "20052773098": 1,
        "20052773099": 1,
        "20052773100": 2,
        "20052773101": 1,
        "20052773102": 2,
        "20052773103": 1,
        "20052773104": 1,
        "20052773105": 2,
        "20052773106": 1,
        "20052773107": 2,
        "20052773108": 1,
        "20052773109": 1,
        "20052773110": 2,
        "20052773111": 1,
        "20052773112": 2,
        "20052773113": 1,
        "20052773114": 1,
        "20052773115": 2,
        "20052773116": 1,
        "20052773117": 2,
        "20052773118": 1,
        "20052773119": 1,
        "20052773120": 2,
        "20052773121": 1,
        "20052773122": 2,
        "20052773123": 1,
        "20052773124": 1,
        "20052773125": 2,
        "20052773126": 1,
        "20052773127": 2,
        "20052773128": 1,
        "20052773129": 1,
        "20052773130": 2,
        "20052773131": 1,
        "20052773132": 2,
        "20052773133": 1,
        "20052773134": 1,
        "20052773135": 2,
        "20052773136": 1,
        "20052773137": 2,
        "20052773138": 1,
        "20052773139": 1,
        "20052773140": 2,
        "20052773141": 1,
        "20052773142": 2,
        "20052773143": 1,
        "20052773144": 1,
        "20052773145": 2,
        "20052773146": 1,
        "20052773147": 2,
        "20052773148": 1,
        "20052773149": 1,
        "20052773150": 2,
        "20052773151": 1,
        "20052773152": 2,
        "20052773153": 1,
        "20052773154": 1,
        "20052773155": 2,
        "20052773156": 1,
        "20052773157": 2,
        "20052773158": 1,
        "20052773159": 1,
        "20052773160": 2,
        "20052773161": 1,
        "20052773162": 2,
        "20052773163": 1,
        "20052773164": 1,
        "20052773165": 2,
        "20052773166": 1,
        "20052773167": 2,
        "20052773168": 1,
        "20052773169": 1,
        "20052773170": 2,
        "20052773171": 1,
        "20052773172": 2,
        "20052773173": 1,
        "20052773174": 1,
        "20052773175": 2,
        "20052773176": 1,
        "20052773177": 2,
        "20052773178": 1,
        "20052773179": 1,
        "20052773180": 2,
        "20052773181": 1,
        "20052773182": 2,
        "20052773183": 1,
        "20052773184": 1,
        "20052773185": 2,
        "20052773186": 1,
        "20052773187": 2,
        "20052773188": 1,
        "20052773189": 1,
        "20052773190": 2,
        "20052773191": 1,
        "20052773192": 2,
        "20052773193": 1,
        "20052773194": 1,
        "20052773195": 2,
        "20052773196": 1,
        "20052773197": 2,
        "20052773198": 1,
        "20052773199": 1,
        "20052773200": 2
        }

        """
        #50 products ramping factor
        ramping_factor = {
        "20052773030": 2,
        "20052773001": 2,
        "20052773002": 1,
        "20052773003": 1,
        "20052773004": 1,
        "20052773005": 1,
        "20052773006": 2,
        "20052773007": 1,
        "20052773008": 1,
        "20052773009": 2,
        "20052773010": 2,
        "20052773011": 1,
        "20052773012": 1,
        "20052773013": 2,
        "20052773014": 2,
        "20052773015": 2,
        "20052773016": 1,
        "20052773017": 1,
        "20052773018": 1,
        "20052773019": 1,
        "20052773020": 2,
        "20052773021": 1,
        "20052773022": 1,
        "20052773023": 2,
        "20052773024": 2,
        "20052773025": 1,
        "20052773038": 4,
        "20052773039": 5,
        "20052773040": 2,
        "20052773041": 5,
        "20052773026": 2,
        "20052773027": 1,
        "20052773042": 3,
        "20052773043": 4,
        "20052773044": 6,
        "20052773045": 5,
        "20052773028": 2,
        "20052773046": 4,
        "20052773047": 7,
        "20052773048": 3,
        "20052773049": 4,
        "20052773050": 4,
        "20052773033": 2,
        "20052773034": 1,
        "20052773035": 2,
        "20052773036": 1,
        "20052773037": 2,
        "20052773031": 1,
        "20052773032": 2,
        "20052773029": 1
        }
        """

        """
        #5 products toy problem
        ramping_factor = {
        "20052773002": 1,
        "20052773005": 1,
        "20052773006": 2,
        "20052773007": 1,
        "20052773008": 1}
        """

        """
        Cost Construction:
            - F (penalty on failing to meet demand)
                     F = {f"{id}" : random.uniform(30, 40) for id in product_ids}
            - H (penalty on overstocking inventory)
                     H = {f"{id}" : F[f"{id}"]/2 for id in product_ids}
            - G (Reward for maintaining recommended safety stock)
                     G = {f"{id}" : F[f"{id}"]/3 for id in product_ids}
            - alpha (Penalty for violating proportionality)
                     alpha = 25
        """

        #F = {f"{id}" : random.uniform(30, 40) for id in product_ids}
        #H = {f"{id}" : random.uniform(15, 20) for id in product_ids}
        #G = {f"{id}" : random.uniform(10, 14) for id in product_ids}
        
        #200 products
        F = {
        "20052773001": 39.941893645681944,
        "20052773002": 35.62418087896188,
        "20052773003": 39.28131343323098,
        "20052773004": 37.390625382372406,
        "20052773005": 33.96974390290346,
        "20052773006": 30.475698378672593,
        "20052773007": 35.28321763738729,
        "20052773008": 32.200197017293114,
        "20052773009": 31.223413378866,
        "20052773010": 39.941893645681944,
        "20052773011": 35.62418087896188,
        "20052773012": 39.28131343323098,
        "20052773013": 37.390625382372406,
        "20052773014": 33.96974390290346,
        "20052773015": 30.475698378672593,
        "20052773016": 35.28321763738729,
        "20052773017": 32.200197017293114,
        "20052773018": 35.62418087896188,
        "20052773019": 39.28131343323098,
        "20052773020": 37.390625382372406,
        "20052773021": 33.96974390290346,
        "20052773022": 30.475698378672593,
        "20052773023": 35.28321763738729,
        "20052773024": 32.200197017293114,
        "20052773025": 35.28321763738729,
        "20052773026": 32.200197017293114,
        "20052773027": 31.223413378866,
        "20052773028": 39.941893645681944,
        "20052773029": 35.62418087896188,
        "20052773030": 39.28131343323098,
        "20052773031": 35.62418087896188,
        "20052773032": 39.28131343323098,
        "20052773033": 37.390625382372406,
        "20052773034": 33.96974390290346,
        "20052773035": 30.475698378672593,
        "20052773036": 35.28321763738729,
        "20052773037": 32.200197017293114,
        "20052773038": 31.223413378866,
        "20052773039": 32.156026169786095,
        "20052773040": 39.27856441263787,
        "20052773041": 39.05259758940265,
        "20052773042": 32.05908829632462,
        "20052773043": 31.731439664639105,
        "20052773044": 31.505601858484727,
        "20052773045": 36.1772862489711,
        "20052773046": 36.933300082374224,
        "20052773047": 39.01154198468994,
        "20052773048": 33.45874336264806,
        "20052773049": 39.831010014190056,
        "20052773050": 36.36427265171041,
        "20052773051": 30.041950109250575,
        "20052773052": 31.307269137006585,
        "20052773053": 35.99787024116145,
        "20052773054": 31.480194837603317,
        "20052773055": 31.81820029116381,
        "20052773056": 32.33442669417662,
        "20052773057": 39.26716757870061,
        "20052773058": 31.41348109848288,
        "20052773059": 30.593981308351026,
        "20052773060": 37.68705730902059,
        "20052773061": 33.97206247532818,
        "20052773062": 33.040419878370166,
        "20052773063": 30.72013059981064,
        "20052773064": 33.499813842674676,
        "20052773065": 35.19762945164028,
        "20052773066": 39.54145822316104,
        "20052773067": 35.95410073861985,
        "20052773068": 39.55400595877438,
        "20052773069": 34.462954010173966,
        "20052773070": 31.01591382765025,
        "20052773071": 32.953331428707514,
        "20052773072": 31.65926147033172,
        "20052773073": 32.09980208677369,
        "20052773074": 38.17961230247535,
        "20052773075": 35.49829516281247,
        "20052773076": 36.44017891813168,
        "20052773077": 36.89222405771014,
        "20052773078": 32.562483828282595,
        "20052773079": 39.08042143269173,
        "20052773080": 32.181935769488916,
        "20052773081": 34.021673175372456,
        "20052773082": 31.597403226171647,
        "20052773083": 30.45167141459879,
        "20052773084": 31.02232532438319,
        "20052773085": 34.06167875364467,
        "20052773086": 36.04381102569795,
        "20052773087": 32.904025649942966,
        "20052773088": 31.106658474788563,
        "20052773089": 30.70773455705191,
        "20052773090": 31.695529393783495,
        "20052773091": 34.6742461632392,
        "20052773092": 34.47409950770188,
        "20052773093": 39.61965014025522,
        "20052773094": 30.966010016137343,
        "20052773095": 32.394361277673504,
        "20052773096": 31.465666266997292,
        "20052773097": 38.487814783833414,
        "20052773098": 30.062960559166328,
        "20052773099": 35.72114373408546,
        "20052773100": 38.207771141402155,
        "20052773101": 33.80097228998065,
        "20052773102": 34.85583222341456,
        "20052773103": 30.166820023027192,
        "20052773104": 37.7729382897694,
        "20052773105": 33.8656054206314,
        "20052773106": 35.250077393258856,
        "20052773107": 30.259091794063597,
        "20052773108": 34.291167006660885,
        "20052773109": 30.879951670946333,
        "20052773110": 37.22789058728449,
        "20052773111": 36.11238763078004,
        "20052773112": 31.425714735988606,
        "20052773113": 30.76144989565555,
        "20052773114": 36.67676768653211,
        "20052773115": 31.165007731028577,
        "20052773116": 33.2196041632616,
        "20052773117": 37.53176510219949,
        "20052773118": 33.669671302397326,
        "20052773119": 33.84769906123152,
        "20052773120": 39.64028946071066,
        "20052773121": 31.365176781472638,
        "20052773122": 30.843000863806832,
        "20052773123": 34.11599817126796,
        "20052773124": 39.420236927821925,
        "20052773125": 34.73190609968715,
        "20052773126": 36.76265041164627,
        "20052773127": 35.23020260280236,
        "20052773128": 38.867849079572615,
        "20052773129": 37.1064849963654,
        "20052773130": 31.664183492760348,
        "20052773131": 38.94694346172977,
        "20052773132": 35.97996342310986,
        "20052773133": 33.310586486908264,
        "20052773134": 38.44875727504609,
        "20052773135": 37.261271142029,
        "20052773136": 35.398131830648346,
        "20052773137": 34.43072456114052,
        "20052773138": 33.467305509645946,
        "20052773139": 35.990247172147164,
        "20052773140": 38.27014424531323,
        "20052773141": 33.1301664147076,
        "20052773142": 31.978305070228927,
        "20052773143": 39.07638139110149,
        "20052773144": 31.526564810614765,
        "20052773145": 38.826436979897316,
        "20052773146": 38.32737466844662,
        "20052773147": 30.689159656107638,
        "20052773148": 30.83902352102023,
        "20052773149": 39.436219828266275,
        "20052773150": 38.04091131807397,
        "20052773151": 38.505731215716594,
        "20052773152": 34.90144124485234,
        "20052773153": 35.88190429593057,
        "20052773154": 32.44573018724784,
        "20052773155": 36.87760030028255,
        "20052773156": 38.94213900908202,
        "20052773157": 35.86089355702808,
        "20052773158": 39.68166428249053,
        "20052773159": 35.0853393573948,
        "20052773160": 34.11041988503181,
        "20052773161": 36.71875087862876,
        "20052773162": 33.59454055357417,
        "20052773163": 35.26943995222907,
        "20052773164": 32.210282241688425,
        "20052773165": 33.774724308292484,
        "20052773166": 36.851754058067954,
        "20052773167": 38.16218299513075,
        "20052773168": 32.038086454955554,
        "20052773169": 38.12030394342417,
        "20052773170": 38.04565205787746,
        "20052773171": 38.615919873206735,
        "20052773172": 30.14718416496548,
        "20052773173": 34.50168531356795,
        "20052773174": 35.81599824701022,
        "20052773175": 31.032050335259797,
        "20052773176": 30.62264608760958,
        "20052773177": 33.16676559353815,
        "20052773178": 34.97945715344667,
        "20052773179": 38.73457673115348,
        "20052773180": 35.36300774547208,
        "20052773181": 36.463439340725316,
        "20052773182": 32.09781864946467,
        "20052773183": 33.091772167490085,
        "20052773184": 32.00506690046176,
        "20052773185": 30.10742857570205,
        "20052773186": 31.214951743544564,
        "20052773187": 34.40220604973874,
        "20052773188": 30.137759259975432,
        "20052773189": 31.982585630348925,
        "20052773190": 36.88684884687302,
        "20052773191": 31.15176911612716,
        "20052773192": 37.419335197194954,
        "20052773193": 32.62727526286741,
        "20052773194": 30.00374529797999,
        "20052773195": 33.313785554013776,
        "20052773196": 35.99310954002767,
        "20052773197": 32.95043061548049,
        "20052773198": 36.28371768808151,
        "20052773199": 31.082677675806593,
        "20052773200": 30.608131751409815
        }
        H = {
        "20052773001": 19.970946822840972,
        "20052773002": 17.81209043948094,
        "20052773003": 19.64065671661549,
        "20052773004": 18.695312691186203,
        "20052773005": 16.98487195145173,
        "20052773006": 15.237849189336297,
        "20052773007": 17.641608818693644,
        "20052773008": 16.100098508646557,
        "20052773009": 15.223413378866,
        "20052773010": 17.941893645681944,
        "20052773011": 16.62418087896188,
        "20052773012": 15.28131343323098,
        "20052773013": 15.390625382372406,
        "20052773014": 18.96974390290346,
        "20052773015": 17.475698378672593,
        "20052773016": 19.28321763738729,
        "20052773017": 15.200197017293114,
        "20052773018": 16.62418087896188,
        "20052773019": 19.28131343323098,
        "20052773020": 17.390625382372406,
        "20052773021": 16.96974390290346,
        "20052773022": 16.475698378672593,
        "20052773023": 15.28321763738729,
        "20052773024": 17.200197017293114,
        "20052773025": 16.28321763738729,
        "20052773026": 18.200197017293114,
        "20052773027": 18.223413378866,
        "20052773028": 15.941893645681944,
        "20052773029": 16.62418087896188,
        "20052773030": 17.28131343323098,
        "20052773031": 17.62418087896188,
        "20052773032": 18.28131343323098,
        "20052773033": 17.390625382372406,
        "20052773034": 15.96974390290346,
        "20052773035": 15.475698378672593,
        "20052773036": 15.28321763738729,
        "20052773037": 18.200197017293114,
        "20052773038": 15.611706689433,
        "20052773039": 16.078013084893048,
        "20052773040": 19.639282206318935,
        "20052773041": 19.526298794701326,
        "20052773042": 16.02954414816231,
        "20052773043": 15.865719832319552,
        "20052773044": 15.752800929242364,
        "20052773045": 18.08864312448555,
        "20052773046": 18.466650041187112,
        "20052773047": 19.50577099234497,
        "20052773048": 16.72937168132403,
        "20052773049": 19.915505007095028,
        "20052773050": 18.182136325855204,
        "20052773051": 18.84815216416344,
        "20052773052": 16.15075431720193,
        "20052773053": 15.059847150690356,
        "20052773054": 18.129827070615875,
        "20052773055": 19.086846494144467,
        "20052773056": 19.870580986055085,
        "20052773057": 16.34515191875163,
        "20052773058": 15.341365073809158,
        "20052773059": 17.91394307705737,
        "20052773060": 16.172675512100867,
        "20052773061": 19.222969645924408,
        "20052773062": 19.612336082667984,
        "20052773063": 18.150934045344712,
        "20052773064": 18.69764206594636,
        "20052773065": 15.997422713137986,
        "20052773066": 19.43455464594743,
        "20052773067": 18.90579255113629,
        "20052773068": 18.01131285770682,
        "20052773069": 18.725384215880556,
        "20052773070": 19.54288201343696,
        "20052773071": 15.314114373248277,
        "20052773072": 19.2413437655826,
        "20052773073": 16.843556229612766,
        "20052773074": 19.331628897427436,
        "20052773075": 18.546650145278477,
        "20052773076": 19.025927511510687,
        "20052773077": 17.20355411561163,
        "20052773078": 16.8871469479513,
        "20052773079": 15.691629645772283,
        "20052773080": 18.520499888256314,
        "20052773081": 19.02701217741641,
        "20052773082": 18.4740693836633,
        "20052773083": 19.505020362274664,
        "20052773084": 19.209771412246727,
        "20052773085": 17.385819581725663,
        "20052773086": 19.74941320897656,
        "20052773087": 18.033449609863396,
        "20052773088": 17.679898000353504,
        "20052773089": 15.120865032680305,
        "20052773090": 18.753427385368393,
        "20052773091": 18.92982365672819,
        "20052773092": 15.882370655093606,
        "20052773093": 16.79899665438546,
        "20052773094": 16.15621712605367,
        "20052773095": 15.24856571462786,
        "20052773096": 18.268516135855087,
        "20052773097": 19.782426225467034,
        "20052773098": 16.254387162414194,
        "20052773099": 19.93635724917155,
        "20052773100": 17.736192078251634,
        "20052773101": 16.692819384048004,
        "20052773102": 19.847655116247676,
        "20052773103": 19.567739625235145,
        "20052773104": 19.279683584426095,
        "20052773105": 15.215526238175952,
        "20052773106": 18.477270771244388,
        "20052773107": 18.018360835779134,
        "20052773108": 19.78160880860127,
        "20052773109": 15.520321507079002,
        "20052773110": 18.069998432847818,
        "20052773111": 17.207967690993268,
        "20052773112": 16.856963128532897,
        "20052773113": 16.862820980219606,
        "20052773114": 16.691023072148734,
        "20052773115": 19.45288557551007,
        "20052773116": 19.30023571408784,
        "20052773117": 17.841375289308722,
        "20052773118": 18.261442355520124,
        "20052773119": 16.622055177970598,
        "20052773120": 18.59449801167043,
        "20052773121": 19.55711247510117,
        "20052773122": 19.22541818272206,
        "20052773123": 17.087406898865392,
        "20052773124": 17.397731881303653,
        "20052773125": 18.43479417765449,
        "20052773126": 16.795497675748965,
        "20052773127": 16.124648342017334,
        "20052773128": 19.825318926558147,
        "20052773129": 16.04200978063418,
        "20052773130": 16.685018254497738,
        "20052773131": 16.504373699231216,
        "20052773132": 16.053609159408516,
        "20052773133": 18.857975237605633,
        "20052773134": 16.6029564059195,
        "20052773135": 17.440626006247356,
        "20052773136": 15.664415921948791,
        "20052773137": 15.866861061664066,
        "20052773138": 16.03691935662038,
        "20052773139": 19.39830940757786,
        "20052773140": 15.64326237159575,
        "20052773141": 18.003407117269234,
        "20052773142": 18.033112459239856,
        "20052773143": 16.12604271310719,
        "20052773144": 16.43477342441102,
        "20052773145": 19.223181357556534,
        "20052773146": 17.00494991861395,
        "20052773147": 18.683433383325344,
        "20052773148": 15.365984226310568,
        "20052773149": 17.412777504148565,
        "20052773150": 17.89428329162789,
        "20052773151": 15.295845973737157,
        "20052773152": 18.62471401780043,
        "20052773153": 17.39808775058308,
        "20052773154": 16.294425201209656,
        "20052773155": 19.10190540910733,
        "20052773156": 15.365114355375798,
        "20052773157": 19.830652337034508,
        "20052773158": 19.379500075526366,
        "20052773159": 17.191842707536633,
        "20052773160": 18.886426400837784,
        "20052773161": 18.7237586521777,
        "20052773162": 17.909630176593403,
        "20052773163": 15.646881969327069,
        "20052773164": 15.27963462124072,
        "20052773165": 19.790993042197435,
        "20052773166": 16.118654415142007,
        "20052773167": 17.96776329498692,
        "20052773168": 19.321952873646914,
        "20052773169": 16.7746924210105,
        "20052773170": 16.899461824221692,
        "20052773171": 19.86691800269668,
        "20052773172": 15.512164830353218,
        "20052773173": 19.46953147010567,
        "20052773174": 18.44298893098823,
        "20052773175": 18.854946001589088,
        "20052773176": 16.83866762255061,
        "20052773177": 19.449158141780256,
        "20052773178": 16.059305569551928,
        "20052773179": 17.504866133507836,
        "20052773180": 17.333589477958032,
        "20052773181": 17.296466419227954,
        "20052773182": 17.00734185492285,
        "20052773183": 16.192981165757303,
        "20052773184": 18.64518401913553,
        "20052773185": 19.593576928553947,
        "20052773186": 16.28967372737901,
        "20052773187": 19.326232952940682,
        "20052773188": 17.258463363812503,
        "20052773189": 15.628698423703188,
        "20052773190": 17.489064991308002,
        "20052773191": 15.392763737154143,
        "20052773192": 19.04713372021345,
        "20052773193": 16.56079111614818,
        "20052773194": 16.24853511171984,
        "20052773195": 17.32598908737033,
        "20052773196": 18.038610694318372,
        "20052773197": 19.703619992111946,
        "20052773198": 17.445924016636532,
        "20052773199": 16.057078007111432,
        "20052773200": 19.850785825745824
        }
        G = {
        "20052773001": 13.313964548560648,
        "20052773002": 11.87472695965396,
        "20052773003": 13.093771144410326,
        "20052773004": 12.463541794124135,
        "20052773005": 11.323247967634487,
        "20052773006": 10.158566126224198,
        "20052773007": 11.761072545795763,
        "20052773008": 10.73339900576437,
        "20052773009": 11.223413378866,
        "20052773010": 10.941893645681944,
        "20052773011": 12.62418087896188,
        "20052773012": 12.28131343323098,
        "20052773013": 10.390625382372406,
        "20052773014": 11.96974390290346,
        "20052773015": 13.475698378672593,
        "20052773016": 13.28321763738729,
        "20052773017": 12.200197017293114,
        "20052773018": 13.62418087896188,
        "20052773019": 11.28131343323098,
        "20052773020": 11.390625382372406,
        "20052773021": 10.96974390290346,
        "20052773022": 10.475698378672593,
        "20052773023": 13.28321763738729,
        "20052773024": 12.200197017293114,
        "20052773025": 12.28321763738729,
        "20052773026": 12.200197017293114,
        "20052773027": 11.223413378866,
        "20052773028": 13.941893645681944,
        "20052773029": 10.62418087896188,
        "20052773030": 10.28131343323098,
        "20052773031": 13.62418087896188,
        "20052773032": 13.28131343323098,
        "20052773033": 11.390625382372406,
        "20052773034": 13.96974390290346,
        "20052773035": 13.475698378672593,
        "20052773036": 12.28321763738729,
        "20052773037": 12.200197017293114,
        "20052773038": 10.407804459622,
        "20052773039": 10.718675389928698,
        "20052773040": 13.092854804212623,
        "20052773041": 13.017532529800883,
        "20052773042": 10.686362765441539,
        "20052773043": 10.577146554879702,
        "20052773044": 10.501867286161575,
        "20052773045": 12.0590954163237,
        "20052773046": 12.311100027458075,
        "20052773047": 13.00384732822998,
        "20052773048": 11.152914454216019,
        "20052773049": 13.277003338063352,
        "20052773050": 12.121424217236802,
        "20052773051": 12.774345302088028,
        "20052773052": 11.441654016051881,
        "20052773053": 11.57791055116588,
        "20052773054": 13.141178936817312,
        "20052773055": 11.246807417232924,
        "20052773056": 12.04682236244821,
        "20052773057": 13.565081927361728,
        "20052773058": 13.0750726543657,
        "20052773059": 12.44493900735333,
        "20052773060": 13.055137561481132,
        "20052773061": 12.058647007944824,
        "20052773062": 10.29176730656016,
        "20052773063": 10.981856209628313,
        "20052773064": 12.118523740999683,
        "20052773065": 10.678840620701195,
        "20052773066": 13.081334829963138,
        "20052773067": 13.020174898595604,
        "20052773068": 13.843996451380262,
        "20052773069": 11.437421680721686,
        "20052773070": 12.775822540783475,
        "20052773071": 11.78432541033592,
        "20052773072": 10.43597302261825,
        "20052773073": 13.746453063553798,
        "20052773074": 10.99754452987833,
        "20052773075": 13.671748059528749,
        "20052773076": 13.297920606581599,
        "20052773077": 13.022388757352923,
        "20052773078": 11.213909675191035,
        "20052773079": 11.232483025147213,
        "20052773080": 11.001086405405925,
        "20052773081": 10.262193816283375,
        "20052773082": 10.01379230812877,
        "20052773083": 11.591123292624692,
        "20052773084": 12.543814978763415,
        "20052773085": 12.002572920645036,
        "20052773086": 10.28371175427798,
        "20052773087": 10.828069023442437,
        "20052773088": 12.667157298010697,
        "20052773089": 10.021757372028357,
        "20052773090": 11.826423760825072,
        "20052773091": 13.689428340425545,
        "20052773092": 11.93666277977246,
        "20052773093": 11.9170694619856,
        "20052773094": 13.273755095650564,
        "20052773095": 13.283708142791244,
        "20052773096": 13.798436563999088,
        "20052773097": 12.945122718625274,
        "20052773098": 10.399186893653262,
        "20052773099": 12.170319118184942,
        "20052773100": 12.173430050102183,
        "20052773101": 11.454370868174161,
        "20052773102": 12.081556681764337,
        "20052773103": 11.358497042429322,
        "20052773104": 12.149616741992649,
        "20052773105": 13.1698895998886,
        "20052773106": 13.957907331745464,
        "20052773107": 10.035992173459936,
        "20052773108": 12.754961246456919,
        "20052773109": 13.857526761853578,
        "20052773110": 10.184126534708245,
        "20052773111": 12.516514029459195,
        "20052773112": 13.800332153140253,
        "20052773113": 11.620149698532138,
        "20052773114": 11.29539983935066,
        "20052773115": 12.779604198558228,
        "20052773116": 13.212503950287905,
        "20052773117": 12.259663838449235,
        "20052773118": 13.031965959097803,
        "20052773119": 12.142384661459586,
        "20052773120": 11.957491403486939,
        "20052773121": 12.63520902275041,
        "20052773122": 11.45131194533148,
        "20052773123": 10.18727810946498,
        "20052773124": 11.784249234782358,
        "20052773125": 13.51350162302688,
        "20052773126": 12.095371281987143,
        "20052773127": 11.73267029145398,
        "20052773128": 11.535489409223327,
        "20052773129": 10.397856160995104,
        "20052773130": 13.213400672974252,
        "20052773131": 11.536789098703457,
        "20052773132": 10.669387411446815,
        "20052773133": 10.507358449567313,
        "20052773134": 12.769522020863747,
        "20052773135": 13.38406148754352,
        "20052773136": 12.032421023117612,
        "20052773137": 11.597720349843835,
        "20052773138": 10.278218189683503,
        "20052773139": 13.138581688417364,
        "20052773140": 12.989652918966733,
        "20052773141": 10.711531178091683,
        "20052773142": 10.30802046301053,
        "20052773143": 11.984054408071424,
        "20052773144": 10.124295206398074,
        "20052773145": 12.914775075500284,
        "20052773146": 10.709609292502119,
        "20052773147": 10.99793613095854,
        "20052773148": 12.211437671509204,
        "20052773149": 10.046352368297867,
        "20052773150": 13.12162294241864,
        "20052773151": 10.840215191444774,
        "20052773152": 13.34102431537619,
        "20052773153": 13.297113789064978,
        "20052773154": 12.553180526925226,
        "20052773155": 13.158440003254027,
        "20052773156": 12.511203472448265,
        "20052773157": 13.493907909913869,
        "20052773158": 11.138501456187438,
        "20052773159": 10.175577190855392,
        "20052773160": 11.797373428476554,
        "20052773161": 12.987599766007438,
        "20052773162": 11.640655430375299,
        "20052773163": 13.582532566631345,
        "20052773164": 10.785167165217743,
        "20052773165": 12.20883403592756,
        "20052773166": 13.591227169639444,
        "20052773167": 13.58856261791634,
        "20052773168": 12.217647283080476,
        "20052773169": 13.320216539321637,
        "20052773170": 11.868273666139947,
        "20052773171": 10.82468125600495,
        "20052773172": 10.255756483647746,
        "20052773173": 13.414925671419537,
        "20052773174": 11.246607522567592,
        "20052773175": 10.800398016126795,
        "20052773176": 12.226029633037587,
        "20052773177": 13.788399626422072,
        "20052773178": 12.358543796545684,
        "20052773179": 10.565157447003863,
        "20052773180": 10.87881953078976,
        "20052773181": 12.403972715857085,
        "20052773182": 11.146356686515846,
        "20052773183": 10.485431062200863,
        "20052773184": 10.109727424783069,
        "20052773185": 13.59462838070679,
        "20052773186": 10.676620297508357,
        "20052773187": 12.84257726220514,
        "20052773188": 12.317492289811584,
        "20052773189": 10.031281818263144,
        "20052773190": 11.898194209825228,
        "20052773191": 13.804479794462791,
        "20052773192": 10.097171741230872,
        "20052773193": 12.195775275343568,
        "20052773194": 13.505511766012638,
        "20052773195": 11.591622206264915,
        "20052773196": 11.446982430321194,
        "20052773197": 11.69104994065172,
        "20052773198": 11.518358110084272,
        "20052773199": 13.786655701685902,
        "20052773200": 13.861220097859638
        }

        """
        #50 products
        F = {
        "20052773001": 39.941893645681944,
        "20052773002": 35.62418087896188,
        "20052773003": 39.28131343323098,
        "20052773004": 37.390625382372406,
        "20052773005": 33.96974390290346,
        "20052773006": 30.475698378672593,
        "20052773007": 35.28321763738729,
        "20052773008": 32.200197017293114,
        "20052773009": 31.223413378866,
        "20052773010": 39.941893645681944,
        "20052773011": 35.62418087896188,
        "20052773012": 39.28131343323098,
        "20052773013": 37.390625382372406,
        "20052773014": 33.96974390290346,
        "20052773015": 30.475698378672593,
        "20052773016": 35.28321763738729,
        "20052773017": 32.200197017293114,
        "20052773018": 35.62418087896188,
        "20052773019": 39.28131343323098,
        "20052773020": 37.390625382372406,
        "20052773021": 33.96974390290346,
        "20052773022": 30.475698378672593,
        "20052773023": 35.28321763738729,
        "20052773024": 32.200197017293114,
        "20052773025": 35.28321763738729,
        "20052773026": 32.200197017293114,
        "20052773027": 31.223413378866,
        "20052773028": 39.941893645681944,
        "20052773029": 35.62418087896188,
        "20052773030": 39.28131343323098,
        "20052773031": 35.62418087896188,
        "20052773032": 39.28131343323098,
        "20052773033": 37.390625382372406,
        "20052773034": 33.96974390290346,
        "20052773035": 30.475698378672593,
        "20052773036": 35.28321763738729,
        "20052773037": 32.200197017293114,
        "20052773038": 31.223413378866,
        "20052773039": 32.156026169786095,
        "20052773040": 39.27856441263787,
        "20052773041": 39.05259758940265,
        "20052773042": 32.05908829632462,
        "20052773043": 31.731439664639105,
        "20052773044": 31.505601858484727,
        "20052773045": 36.1772862489711,
        "20052773046": 36.933300082374224,
        "20052773047": 39.01154198468994,
        "20052773048": 33.45874336264806,
        "20052773049": 39.831010014190056,
        "20052773050": 36.36427265171041
        }
        H = {
        "20052773001": 19.970946822840972,
        "20052773002": 17.81209043948094,
        "20052773003": 19.64065671661549,
        "20052773004": 18.695312691186203,
        "20052773005": 16.98487195145173,
        "20052773006": 15.237849189336297,
        "20052773007": 17.641608818693644,
        "20052773008": 16.100098508646557,
        "20052773009": 15.223413378866,
        "20052773010": 17.941893645681944,
        "20052773011": 16.62418087896188,
        "20052773012": 15.28131343323098,
        "20052773013": 15.390625382372406,
        "20052773014": 18.96974390290346,
        "20052773015": 17.475698378672593,
        "20052773016": 19.28321763738729,
        "20052773017": 15.200197017293114,
        "20052773018": 16.62418087896188,
        "20052773019": 19.28131343323098,
        "20052773020": 17.390625382372406,
        "20052773021": 16.96974390290346,
        "20052773022": 16.475698378672593,
        "20052773023": 15.28321763738729,
        "20052773024": 17.200197017293114,
        "20052773025": 16.28321763738729,
        "20052773026": 18.200197017293114,
        "20052773027": 18.223413378866,
        "20052773028": 15.941893645681944,
        "20052773029": 16.62418087896188,
        "20052773030": 17.28131343323098,
        "20052773031": 17.62418087896188,
        "20052773032": 18.28131343323098,
        "20052773033": 17.390625382372406,
        "20052773034": 15.96974390290346,
        "20052773035": 15.475698378672593,
        "20052773036": 15.28321763738729,
        "20052773037": 18.200197017293114,
        "20052773038": 15.611706689433,
        "20052773039": 16.078013084893048,
        "20052773040": 19.639282206318935,
        "20052773041": 19.526298794701326,
        "20052773042": 16.02954414816231,
        "20052773043": 15.865719832319552,
        "20052773044": 15.752800929242364,
        "20052773045": 18.08864312448555,
        "20052773046": 18.466650041187112,
        "20052773047": 19.50577099234497,
        "20052773048": 16.72937168132403,
        "20052773049": 19.915505007095028,
        "20052773050": 18.182136325855204
        }
        G = {
        "20052773001": 13.313964548560648,
        "20052773002": 11.87472695965396,
        "20052773003": 13.093771144410326,
        "20052773004": 12.463541794124135,
        "20052773005": 11.323247967634487,
        "20052773006": 10.158566126224198,
        "20052773007": 11.761072545795763,
        "20052773008": 10.73339900576437,
        "20052773009": 11.223413378866,
        "20052773010": 10.941893645681944,
        "20052773011": 12.62418087896188,
        "20052773012": 12.28131343323098,
        "20052773013": 10.390625382372406,
        "20052773014": 11.96974390290346,
        "20052773015": 13.475698378672593,
        "20052773016": 13.28321763738729,
        "20052773017": 12.200197017293114,
        "20052773018": 13.62418087896188,
        "20052773019": 11.28131343323098,
        "20052773020": 11.390625382372406,
        "20052773021": 10.96974390290346,
        "20052773022": 10.475698378672593,
        "20052773023": 13.28321763738729,
        "20052773024": 12.200197017293114,
        "20052773025": 12.28321763738729,
        "20052773026": 12.200197017293114,
        "20052773027": 11.223413378866,
        "20052773028": 13.941893645681944,
        "20052773029": 10.62418087896188,
        "20052773030": 10.28131343323098,
        "20052773031": 13.62418087896188,
        "20052773032": 13.28131343323098,
        "20052773033": 11.390625382372406,
        "20052773034": 13.96974390290346,
        "20052773035": 13.475698378672593,
        "20052773036": 12.28321763738729,
        "20052773037": 12.200197017293114,
        "20052773038": 10.407804459622,
        "20052773039": 10.718675389928698,
        "20052773040": 13.092854804212623,
        "20052773041": 13.017532529800883,
        "20052773042": 10.686362765441539,
        "20052773043": 10.577146554879702,
        "20052773044": 10.501867286161575,
        "20052773045": 12.0590954163237,
        "20052773046": 12.311100027458075,
        "20052773047": 13.00384732822998,
        "20052773048": 11.152914454216019,
        "20052773049": 13.277003338063352,
        "20052773050": 12.121424217236802
        }
        """

        """
        #5 products toy problem
        F={
        "20052773002": 30.25998375584437,
        "20052773005": 38.209821809188966,
        "20052773006": 36.011459061742634,
        "20052773007": 30.087054171222288,
        "20052773008": 35.46629059766027
        }
        H={
        "20052773002": 15.129991877922185,
        "20052773005": 19.104910904594483,
        "20052773006": 18.005729530871317,
        "20052773007": 15.043527085611144,
        "20052773008": 17.733145298830134
        }
        G={
        "20052773002": 10.086661251948124,
        "20052773005": 12.736607269729655,
        "20052773006": 12.003819687247544,
        "20052773007": 10.029018057074095,
        "20052773008": 11.822096865886756
        }
        """
        alpha = 25

            
        return cls(
            config = cfg,
            products = products,
            product_mle_params = mle_params,
            ramping_factor = ramping_factor,
            demand_data=demand_data,
            F = F,
            H = H,
            G = G,
            alpha = 25
        )
    
    def write_to_file(self, fpath: str):
        cfg = self.config._asdict()
        del cfg['raw_data_path']
        del cfg['instance_path']
        del cfg['location_id']
        del cfg['items_file'] 
        del cfg['forecast_file'] 
        del cfg['open_positions_file']
        data = {
            "config": cfg,
            "products": [p.to_json() for p in self.products],
            "gamma_params": self.product_mle_params,
            "ramping_factor": self.ramping_factor,
            "demand_data": self.demand_data,
            "fail_demand_cost": self.F,
            "overstocking_cost": self.H,
            "reward_recommended_stock": self.G,
            "proportionality_cost": self.alpha

        }
        with open(fpath, "w") as outfile:
            json.dump(data, outfile, indent=4)
        
    
def main():
    """Prepare the data to be written to file"""
    logging.basicConfig(format='%(asctime)s %(levelname)s--: %(message)s',
                        level=logging.DEBUG)
    cfg = Config()
    log.info('starting data creation.')
    static_data = StaticData.build(cfg)
    fpath = os.path.join(cfg.instance_path, cfg.instance_name + '.json')
    static_data.write_to_file(fpath)
    log.info(f'wrote instance to {fpath}.')


if __name__ == '__main__':
    main()